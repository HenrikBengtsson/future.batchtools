<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Future for batchtools â€¢ future.batchtools</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="A Future for batchtools">
<meta property="og:description" content="future.batchtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-SB3EQSD9FR"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-SB3EQSD9FR');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">future.batchtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.10.0-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/future.batchtools.html">A Future for batchtools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://www.futureverse.org/" class="external-link">
    <span class="fas fa-fast-backward"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="https://BiocParallel.FutureParam.futureverse.org" class="external-link">BiocParallel.FutureParam</a>
    </li>
    <li>
      <a href="https://doFuture.futureverse.org" class="external-link">doFuture</a>
    </li>
    <li>
      <a href="https://furrr.futureverse.org" class="external-link">furrr</a>
    </li>
    <li>
      <a href="https://future.futureverse.org" class="external-link">future</a>
    </li>
    <li>
      <a href="https://future.apply.futureverse.org" class="external-link">future.apply</a>
    </li>
    <li>
      <a href="https://future.batchtools.futureverse.org">future.batchtools</a>
    </li>
    <li>
      <a href="https://future.callr.futureverse.org" class="external-link">future.callr</a>
    </li>
    <li>
      <a href="https://future.tests.futureverse.org" class="external-link">future.tests</a>
    </li>
    <li>
      <a href="https://globals.futureverse.org" class="external-link">globals</a>
    </li>
    <li>
      <a href="https://listenv.futureverse.org" class="external-link">listenv</a>
    </li>
    <li>
      <a href="https://parallelly.futureverse.org" class="external-link">parallelly</a>
    </li>
    <li>
      <a href="https://progressr.futureverse.org" class="external-link">progressr</a>
    </li>
    <li>
      <a href="https://future.mapreduce.futureverse.org" class="external-link">future.mapreduce (experimental)</a>
    </li>
    <li>
      <a href="https://marshal.futureverse.org" class="external-link">marshal (experimental)</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://cloud.r-project.org/package=future.batchtools" class="external-link">
    <span class="fab fa-r-project"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/HenrikBengtsson/future.batchtools/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>A Future for batchtools</h1>
                        <h4 data-toc-skip class="author">Henrik Bengtsson</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/HenrikBengtsson/future.batchtools/blob/master/vignettes/future.batchtools.md.rsp" class="external-link"><code>vignettes/future.batchtools.md.rsp</code></a></small>
      <div class="hidden name"><code>future.batchtools.md.rsp</code></div>

    </div>

    
    
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor" aria-hidden="true"></a>Introduction</h2>
<p>The <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package provides a generic API for using futures in R. A future is a simple yet powerful mechanism to evaluate an R expression and retrieve its value at some point in time. Futures can be resolved in many different ways depending on which strategy is used. There are various types of synchronous and asynchronous futures to choose from in the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package.</p>
<p>This package, <a href="https://cran.r-project.org/package=future.batchtools" class="external-link">future.batchtools</a>, provides a type of futures that utilizes the <a href="https://cran.r-project.org/package=batchtools" class="external-link">batchtools</a> package. This means that <em>any</em> type of backend that the batchtools package supports can be used as a future. More specifically, future.batchtools will allow you or users of your package to leverage the compute power of high-performance computing (HPC) clusters via a simple switch in settings - without having to change any code at all.</p>
<p>For instance, if batchtools is properly configures, the below two expressions for futures <code>x</code> and <code>y</code> will be processed on two different compute nodes:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">library</span>(<span class="st">"future.batchtools"</span>)
<span class="op">&gt;</span><span class="st"> </span><span class="kw">plan</span>(batchtools_torque)
<span class="op">&gt;</span>
<span class="er">&gt;</span><span class="st"> </span>x <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="kw">Sys.sleep</span>(<span class="dv">5</span>); <span class="fl">3.14</span> }
<span class="op">&gt;</span><span class="st"> </span>y <span class="op">%&lt;-%</span><span class="st"> </span>{ <span class="kw">Sys.sleep</span>(<span class="dv">5</span>); <span class="fl">2.71</span> }
<span class="op">&gt;</span><span class="st"> </span>x <span class="op">+</span><span class="st"> </span>y
[<span class="dv">1</span>] <span class="fl">5.85</span></code></pre></div>
<p>This is obviously a toy example to illustrate what futures look like and how to work with them.</p>
<p>A more realistic example comes from the field of cancer research where very large data FASTQ files, which hold a large number of short DNA sequence reads, are produced. The first step toward a biological interpretation of these data is to align the reads in each sample (one FASTQ file) toward the human genome. In order to speed this up, we can have each file be processed by a separate compute node and each node we can use 24 parallel processes such that each process aligns a separate chromosome. Here is an outline of how this nested parallelism could be implemented using futures.</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://future.futureverse.org" class="external-link">"future"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/HenrikBengtsson/listenv" class="external-link">"listenv"</a></span><span class="op">)</span>
<span class="co">## The first level of futures should be submitted to the</span>
<span class="co">## cluster using batchtools.  The second level of futures</span>
<span class="co">## should be using multisession, where the number of</span>
<span class="co">## parallel processes is automatically decided based on</span>
<span class="co">## what the cluster grants to each compute node.</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">batchtools_torque</span>, <span class="va">multisession</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Find all samples (one FASTQ file per sample)</span>
<span class="va">fqs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"[.]fastq$"</span><span class="op">)</span>

<span class="co">## The aligned results are stored in BAM files</span>
<span class="va">bams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/listenv/man/listenv.html" class="external-link">listenv</a></span><span class="op">(</span><span class="op">)</span>

<span class="co">## For all samples (FASTQ files) ...</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">ss</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">fqs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">fq</span> <span class="op">&lt;-</span> <span class="va">fqs</span><span class="op">[</span><span class="va">ss</span><span class="op">]</span>

  <span class="co">## ... use futures to align them ...</span>
  <span class="va">bams</span><span class="op">[[</span><span class="va">ss</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://future.futureverse.org/reference/future.html" class="external-link">%&lt;-%</a></span> <span class="op">{</span>
    <span class="va">bams_ss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/listenv/man/listenv.html" class="external-link">listenv</a></span><span class="op">(</span><span class="op">)</span>
    <span class="co">## ... and for each FASTQ file use a second layer</span>
    <span class="co">## of futures to align the individual chromosomes</span>
    <span class="kw">for</span> <span class="op">(</span><span class="va">cc</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">24</span><span class="op">)</span> <span class="op">{</span>
      <span class="va">bams_ss</span><span class="op">[[</span><span class="va">cc</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://future.futureverse.org/reference/future.html" class="external-link">%&lt;-%</a></span> <span class="fu">htseq</span><span class="fu">::</span><span class="fu">align</span><span class="op">(</span><span class="va">fq</span>, chr <span class="op">=</span> <span class="va">cc</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="co">## Resolve the "chromosome" futures and return as a list</span>
    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">bams_ss</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span>
<span class="co">## Resolve the "sample" futures and return as a list</span>
<span class="va">bams</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">bams</span><span class="op">)</span></code></pre></div>
<p>Note that a user who do not have access to a cluster could use the same script processing samples sequentially and chromosomes in parallel on a single machine using:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">sequential</span>, <span class="va">multisession</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>or samples in parallel and chromosomes sequentially using:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">multisession</span>, <span class="va">sequential</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For an introduction as well as full details on how to use futures, please consult the package vignettes of the <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package.</p>
</div>
<div id="choosing-batchtools-backend" class="section level2">
<h2 class="hasAnchor">
<a href="#choosing-batchtools-backend" class="anchor" aria-hidden="true"></a>Choosing batchtools backend</h2>
<p>The future.batchtools package implements a generic future wrapper for all batchtools backends. Below are the most common types of batchtools backends.</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="53%">
<col width="27%">
</colgroup>
<thead><tr class="header">
<th align="left">Backend</th>
<th align="left">Description</th>
<th align="left">Alternative in future package</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"><code>batchtools_torque</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/TORQUE" class="external-link">TORQUE</a> / PBS job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_slurm</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Slurm_Workload_Manager" class="external-link">Slurm</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_sge</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Oracle_Grid_Engine" class="external-link">Sun/Oracle Grid Engine (SGE)</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_lsf</code></td>
<td align="left">Futures are evaluated via a <a href="https://en.wikipedia.org/wiki/Platform_LSF" class="external-link">Load Sharing Facility (LSF)</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_openlava</code></td>
<td align="left">Futures are evaluated via an <a href="https://en.wikipedia.org/wiki/OpenLava" class="external-link">OpenLava</a> job scheduler</td>
<td align="left">N/A</td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_custom</code></td>
<td align="left">Futures are evaluated via a custom batchtools configuration R script or via a set of cluster functions</td>
<td align="left">N/A</td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_interactive</code></td>
<td align="left">sequential evaluation in the calling R environment</td>
<td align="left"><code>plan(transparent)</code></td>
</tr>
<tr class="even">
<td align="left"><code>batchtools_multicore</code></td>
<td align="left">parallel evaluation by forking the current R process</td>
<td align="left"><code>plan(multicore)</code></td>
</tr>
<tr class="odd">
<td align="left"><code>batchtools_local</code></td>
<td align="left">sequential evaluation in a separate R process (on current machine)</td>
<td align="left"><code>plan(cluster, workers = "localhost")</code></td>
</tr>
</tbody>
</table>
<div id="examples" class="section level3">
<h3 class="hasAnchor">
<a href="#examples" class="anchor" aria-hidden="true"></a>Examples</h3>
<p>Below is an examples illustrating how to use <code>batchtools_torque</code> to configure the batchtools backend. For further details and examples on how to configure batchtools, see the <a href="https://mllg.github.io/batchtools/articles/index.html" class="external-link">batchtools configuration</a> wiki page.</p>
<p>To configure batchtools for job schedulers we need to setup a <code>*.tmpl</code> template file that is used to generate the script used by the scheduler. This is what a template file for TORQUE / PBS may look like:</p>
<div class="sourceCode"><pre class="sourceCode sh"><code class="sourceCode bash">
<span class="co">## Job name:</span>

<span class="co">## Direct streams to logfile:</span>

<span class="co">## Merge standard error and output:</span>

<span class="co">## Email on abort (a) and termination (e), but not when starting (b)</span>

<span class="co">## Resources needed:</span>
<span class="op">&lt;</span><span class="ex">%</span> if (length(resources) <span class="op">&gt;</span> <span class="ex">0</span>) <span class="kw">{</span>
  <span class="ex">opts</span> <span class="op">&lt;</span>- unlist(resources, use.names = TRUE)
  <span class="ex">opts</span> <span class="op">&lt;</span>- sprintf(<span class="st">"%s=%s"</span>, names(opts), <span class="ex">opts</span>)
  <span class="ex">opts</span> <span class="op">&lt;</span>- paste(opts, collapse = <span class="st">","</span>) <span class="ex">%</span><span class="op">&gt;</span>
<span class="op">&lt;</span><span class="ex">%</span> <span class="kw">}</span> <span class="ex">%</span><span class="op">&gt;</span>

<span class="co">## Launch R and evaluated the batchtools R job</span>
<span class="ex">Rscript</span> -e <span class="st">'batchtools::doJobCollection("&lt;%= uri %&gt;")'</span></code></pre></div>
<p>If this template is saved to file <code>batchtools.torque.tmpl</code> (without period) in the working directory or as <code>.batchtools.torque.tmpl</code> (with period) the user's home directory, then it will be automatically located by the batchtools framework and loaded when doing:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plan</span>(batchtools_torque)</code></pre></div>
<p>Resource parameters can be specified via argument <code>resources</code> which should be a named list and is passed as is to the template file. For example, to request that each job would get alloted 12 cores (one a single machine) and up to 5 GiB of memory, use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plan</span>(batchtools_torque, <span class="dt">resources =</span> <span class="kw">list</span>(<span class="dt">nodes =</span> <span class="st">"1:ppn=12"</span>, <span class="dt">vmem =</span> <span class="st">"5gb"</span>))</code></pre></div>
<p>To specify the <code>resources</code> argument at the same time as using nested future strategies, one can use <code><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak()</a></code> to tweak the default arguments. For instance,</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://future.futureverse.org/reference/tweak.html" class="external-link">tweak</a></span><span class="op">(</span><span class="va">batchtools_torque</span>, resources <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>nodes <span class="op">=</span> <span class="st">"1:ppn=12"</span>, vmem <span class="op">=</span> <span class="st">"5gb"</span><span class="op">)</span><span class="op">)</span>,
  <span class="va">multisession</span>
<span class="op">)</span><span class="op">)</span></code></pre></div>
<p>causes the first level of futures to be submitted via the TORQUE job scheduler requesting 12 cores and 5 GiB of memory per job. The second level of futures will be evaluated using multisession using the 12 cores given to each job by the scheduler.</p>
<p>A similar filename format is used for the other types of job schedulers supported. For instance, for Slurm the template file should be named <code>./batchtools.slurm.tmpl</code> or <code>~/.batchtools.slurm.tmpl</code> in order for</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plan</span>(batchtools_slurm)</code></pre></div>
<p>to locate the file automatically. To specify this template file explicitly, use argument <code>template</code>, e.g.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="op">&gt;</span><span class="st"> </span><span class="kw">plan</span>(batchtools_slurm, <span class="dt">template =</span> <span class="st">"/path/to/batchtools.slurm.tmpl"</span>)</code></pre></div>
<p>For further details and examples on how to configure batchtools per se, see the <a href="https://mllg.github.io/batchtools/articles/index.html" class="external-link">batchtools configuration</a> wiki page.</p>
</div>
</div>
<div id="demos" class="section level2">
<h2 class="hasAnchor">
<a href="#demos" class="anchor" aria-hidden="true"></a>Demos</h2>
<p>The <a href="https://cran.r-project.org/package=future" class="external-link">future</a> package provides a demo using futures for calculating a set of Mandelbrot planes. The demo does not assume anything about what type of futures are used. <em>The user has full control of how futures are evaluated</em>. For instance, to use local batchtools futures, run the demo as:</p>
<div class="sourceCode"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://future.batchtools.futureverse.org">"future.batchtools"</a></span><span class="op">)</span>
<span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">batchtools_local</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/demo.html" class="external-link">demo</a></span><span class="op">(</span><span class="st">"mandelbrot"</span>, package <span class="op">=</span> <span class="st">"future"</span>, ask <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Henrik Bengtsson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link external-link">pkgdown</a> 1.9000.9000.9000 and <a href="https://github.com/HenrikBengtsson/pkgdown.extras/">pkgdown.extras</a> 0.0.0.9003.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'aa6e02fc501886fb0f7c91ac4e300456',
    indexName: 'futureverse',
    algoliaOptions: { 'facetFilters': ['project:future.batchtools'] },
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
